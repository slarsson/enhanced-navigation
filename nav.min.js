"use strict";let _app=null;window.addEventListener("DOMContentLoaded",()=>{_app=new NavigationController});const _progressBar=(height,color)=>{const style=document.getElementsByTagName("style");if(0==style.length)throw"Can't bind to stylesheet, abort!";style[0].sheet.insertRule("@keyframes __fade {0% {opacity:1;} 100% {opacity:0;}",style[0].sheet.cssRules.length),style[0].sheet.insertRule(".__fade-out {animation:__fade; animation-duration:0.5s;}",style[0].sheet.cssRules.length);const div=document.createElement("div");div.style.width="0px",div.style.height=height+"px",div.style.position="fixed",div.style.backgroundColor=color,div.onanimationend=()=>{console.log("END ANiM"),div.style.width=0},document.documentElement.insertBefore(div,document.body);let current=0,end=0,timestamp=0,step=1,stall=!0;const progress=()=>{if(current>=end)return void div.classList.add("__fade-out");let now=performance.now();stall&&current>.6*end&&(step=end/8e3,stall=!1),current+=step*(now-timestamp),timestamp=now,div.style.width=current+"px",requestAnimationFrame(progress)};return{start:()=>{div.classList.remove("__fade-out"),stall=!0,current=0,end=window.innerWidth,step=end/2e3,timestamp=performance.now(),progress()},stop:()=>{current=1/0},complete:()=>{stall=!1,step=end/500}}};class NavigationController{constructor(){this.hostname=window.location.hostname,this.cache=new Map,this.lastRequest=null,this.scriptID="swag",this.cacheTTL=12e5,this.progress=_progressBar(3,"#00a3d9"),this.popstate=this.popstate.bind(this),this.handler=this.handler.bind(this),window.onpopstate=this.popstate,this.hydrate()}popstate(evt){this.lastRequest=document.location,null!=evt.state&&null!=evt.state.scroll?this.fetch(document.location,!1,evt.state.scroll):this.fetch(document.location,!1,0)}hydrate(){const nodes=document.querySelectorAll("a[href]");for(const node of nodes)node.hostname==this.hostname&&(node.onclick=this.handler,null!=node.dataset.prefetch&&this.prefetch(node.href))}fetch(url,setHistory,scroll){this.progress.start();let cachedPage=this.cache.get(url);if(void 0!==cachedPage&&cachedPage.ttl>Date.now())return setHistory&&history.pushState({scroll:0},"",url),void this.update(cachedPage.body,scroll);window.fetch(url,{method:"GET"}).then(resp=>resp.text()).then(body=>{this.lastRequest==url&&(setHistory&&history.pushState({scroll:0},"",url),this.update(body,scroll)),this.cache.set(url,{body:body,ttl:Date.now()+this.cacheTTL})}).catch(_=>{window.location.href=url})}prefetch(url){this.cache.has(url)||window.fetch(url,{method:"GET"}).then(resp=>resp.text()).then(body=>this.cache.set(url,{body:body,ttl:Date.now()+this.cacheTTL})).catch(err=>{console.error("prefetch failed:",err)})}update(body,scroll){this.progress.complete(),this.inject(body),this.hydrate(),null!=scroll?window.scrollTo(0,scroll):window.scrollTo(0,0)}handler(evt){evt.preventDefault(),window.history.replaceState({scroll:document.documentElement.scrollTop},"",document.location),this.lastRequest!=evt.currentTarget.href&&(this.lastRequest=evt.currentTarget.href,this.fetch(evt.currentTarget.href,!0,0))}inject(body){const doc=(new DOMParser).parseFromString(body,"text/html"),script=doc.getElementById(this.scriptID);null!==script&&script.remove(),document.title=doc.title,document.head.innerHTML!=doc.head.innerHTML&&document.head.parentNode.replaceChild(doc.head,document.head),document.body.parentNode.replaceChild(doc.body,document.body)}}